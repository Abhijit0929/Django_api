<!DOCTYPE html>
<html>
<head>
    <title>Product List</title>
</head>

<body>

<h1>Product List</h1>

<!-- CSRF TOKEN -->
<form id="csrf-form">
    {% csrf_token %}
</form>

<h2>Add Product</h2>

<input id="name" placeholder="Name">
<input id="price" placeholder="Price">
<input id="description" placeholder="Description">

<button onclick="addProduct()">Add Product</button>

<hr>

<div id="product-container"></div>

<script>

/* =========================
   GET CSRF TOKEN
========================= */
function getCSRFToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]').value;
}


/* =========================
   LOAD PRODUCTS
========================= */
function loadProducts() {

    fetch("/api/products/")
    .then(response => response.json())
    .then(data => {

        const container = document.getElementById("product-container");
        container.innerHTML = "";

        if (data.length === 0) {
            container.innerHTML = "<h3>No Products Available</h3>";
            return;
        }

        data.forEach(product => {

            container.innerHTML += `
                <div style="border:1px solid black; margin:10px; padding:10px;">
                    <h2>${product.name}</h2>
                    <p>Price: ₹${product.price}</p>
                    <p>Description: ${product.description}</p>
                </div>
            `;
        });
    })
    .catch(error => console.error("Fetch Error:", error));
}


/* =========================
   ADD PRODUCT
========================= */
function addProduct() {

    const name = document.getElementById("name").value;
    const price = document.getElementById("price").value;
    const description = document.getElementById("description").value;

    if (!name || !price || !description) {
        alert("Fill all fields");
        return;
    }

    fetch("/api/products/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCSRFToken()
        },
        body: JSON.stringify({
            name: name,
            price: price,
            description: description
        })
    })
    .then(res => {
        if (!res.ok) throw new Error("Failed to add product");
        return res.json();
    })
    .then(data => {
        alert("✅ Product Added Successfully");

        // clear inputs
        document.getElementById("name").value = "";
        document.getElementById("price").value = "";
        document.getElementById("description").value = "";

        loadProducts(); // reload without refresh
    })
    .catch(error => {
        console.error(error);
        alert("❌ Error adding product");
    });
}


/* =========================
   INITIAL LOAD
========================= */
loadProducts();

</script>

</body>
</html>
